CREATE TABLE Function(
                         id int NOT NULL PRIMARY KEY,
                         name varchar(50)
);

CREATE TABLE Speciality(
                           id int NOT NULL PRIMARY KEY,
                           name varchar(50),
                           function_id int,
                           FOREIGN KEY(function_id) REFERENCES Function(id) ON DELETE CASCADE
);

CREATE TABLE User_Details(
                             id int GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
                             name varchar(50),
                             email varchar(50) unique,
                             password varchar(100),
                             speciality_id int,
                             FOREIGN KEY(speciality_id) REFERENCES Speciality(id)
);

CREATE TABLE Reset_Password_Request(
                                       id int NOT NULL PRIMARY KEY,
                                       request_id UUID,
                                       user_id int,
                                       FOREIGN KEY(user_id) REFERENCES User_Details(id)
);

insert into Function(id,name) VALUES (1,'Neurologie');
insert into Function(id,name) VALUES (2,'Cardiologie');
insert into Function(id,name) VALUES (3,'Ortopedie');
insert into Function(id,name) VALUES (4,'Oncologie');
insert into Function(id,name) VALUES (5,'Pediatrie');

insert into Speciality(id,name,function_id) VALUES (1,'Neuroradiologie',1);
insert into Speciality(id,name,function_id) VALUES (2,'Neurochirurgie',1);
insert into Speciality(id,name,function_id) VALUES (3,'Electrofiziologie cardiacă',2);
insert into Speciality(id,name,function_id) VALUES (4,'Chirurgie cardiacă',2);
insert into Speciality(id,name,function_id) VALUES (5,'Chirurgie a mâinii și încheieturii mâinii',3);
insert into Speciality(id,name,function_id) VALUES (6,'Chirurgie a șoldului și a genunchiului',3);
insert into Speciality(id,name,function_id) VALUES (7,'Radioterapie',4);
insert into Speciality(id,name,function_id) VALUES (8,'Chirurgie oncologică',4);
insert into Speciality(id,name,function_id) VALUES (9,'Neonatologie',5);
insert into Speciality(id,name,function_id) VALUES (10,'Endocrinologie pediatrică',5);

insert into User_Details(name,email,password,speciality_id) VALUES ('Calin','calin@gmail.com','sdfsfd',1);

CREATE EXTENSION IF NOT EXISTS "uuid-ossp";
SELECT uuid_generate_v4();
insert into Reset_Password_Request(id,request_id,user_id) VALUES (1,uuid_generate_v4(),1);
ALTER TABLE Reset_Password_Request ADD CONSTRAINT constrId UNIQUE (id);

Create table Diagnosis(
                          id int NOT NULL PRIMARY KEY,
                          inital_diagnosis varchar(50),
                          seventy_two_hour_diagnosis varchar(50),
                          final_diagnosis varchar(50)
);

Create table Patient_Surgery_Details(
                                        id int NOT NULL PRIMARY KEY,
                                        team_of_medics varchar(50),
                                        details varchar(50),
                                        Date date
);

Create table Patient_History_Details(
                                        id int NOT NULL PRIMARY KEY,
                                        heredo_collateral_antecedents varchar(50),
                                        living_conditions varchar(50),
                                        behaviors varchar(50),
                                        background_medication varchar(50),
                                        disease_history varchar(50),
                                        general_clinical_examination varchar(50)
) ;

Create table Insurance_Type(
                               id int NOT NULL PRIMARY KEY,
                               type varchar(50)
);

Create table Insurance_Status(
                                 id int NOT NULL PRIMARY KEY,
                                 status varchar(50)
);

Create table Admission_Type(
                               id int NOT NULL PRIMARY KEY,
                               type varchar(50)
);

Create table Room(
                     id int NOT NULL PRIMARY KEY,
                     name varchar(50),
                     speciality_id int,
                     FOREIGN KEY(speciality_id) REFERENCES Speciality(id) ON DELETE CASCADE
);

Create table Patient(
                        id int NOT NULL PRIMARY KEY,
                        first_name varchar(50) NOT NULL,
                        last_name varchar(50) NOT NULL,
                        gender varchar(50) NOT NULL,
                        birth_date date NOT NULL,
                        address varchar(50) NOT NULL,
                        personal_numeric_code varchar(13) unique NOT NULL,
                        id_series_and_number varchar(50) NOT NULL,
                        type_of_insurance_id int,
                        FOREIGN KEY(type_of_insurance_id) REFERENCES Insurance_Type(id) ON DELETE CASCADE,
                        insurance_status_id int,
                        FOREIGN KEY(insurance_status_id) REFERENCES Insurance_Status(id) ON DELETE CASCADE,
                        type_of_admission_id int,
                        FOREIGN KEY(type_of_admission_id) REFERENCES Admission_Type(id) ON DELETE CASCADE,
                        speciality_id int,
                        FOREIGN KEY(speciality_id) REFERENCES Speciality(id) ON DELETE CASCADE,
                        room_id int,
                        FOREIGN KEY(room_id) REFERENCES Room(id) ON DELETE CASCADE,
                        diagnosis_id int,
                        FOREIGN KEY(diagnosis_id) REFERENCES Diagnosis(id) ON DELETE CASCADE,
                        surgery_details_id int,
                        FOREIGN KEY(surgery_details_id) REFERENCES Patient_Surgery_Details(id) ON DELETE CASCADE,
                        history_details_id int,
                        FOREIGN KEY(history_details_id) REFERENCES Patient_History_Details(id) ON DELETE CASCADE
);

INSERT INTO Patient(id,first_name,last_name,gender,birth_date,address,personal_numeric_code,id_series_and_number,admission_date) VALUES (1,'Ana','Popescu','Women','2023-06-01','Bucharest','6123467891234','PX345667','2023-05-29');
INSERT INTO Patient(id,first_name,last_name,gender,birth_date,address,personal_numeric_code,id_series_and_number,admission_date) VALUES (2,'Maria','Ionescu','Women','2021-05-01','Iasi','6678923401231','PX112032','2023-04-10');
INSERT INTO Patient(id,first_name,last_name,gender,birth_date,address,personal_numeric_code,id_series_and_number,admission_date) VALUES (3,'Mihai','Rotariu','Man','2020-01-10','Ploiesti','5020502981234','PX998234','2023-01-29');
INSERT INTO Patient(id,first_name,last_name,gender,birth_date,address,personal_numeric_code,id_series_and_number,admission_date) VALUES (4,'Smaranda','Pop','Women','2023-03-12','Campina','6543278901238','PX098754','2022-01-29');

UPDATE Patient
SET speciality_id = 1
WHERE id = 2;

UPDATE Patient
SET speciality_id = 1
WHERE id = 3;

UPDATE Patient
SET room_id = 1
WHERE id = 2;

UPDATE Patient
SET room_id = 1
WHERE id = 3;

UPDATE Patient
SET speciality_id = 2
WHERE id = 1;

UPDATE Patient
SET speciality_id = 2
WHERE id = 4;

UPDATE Patient
SET room_id = 1
WHERE id = 4;

Create table Patient_Evolution(
                                  id int NOT NULL PRIMARY KEY,
                                  evolution_description varchar(50),
                                  from_date date,
                                  to_date date,
                                  evolution_id int,
                                  FOREIGN KEY(evolution_id) REFERENCES Patient(id) ON DELETE CASCADE

);

ALTER TABLE Patient
ADD COLUMN admission_date date;

ALTER TABLE Patient
ALTER COLUMN admission_date SET NOT NULL;
